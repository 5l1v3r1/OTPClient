language: c

branches:
  only:
    - master

build:
  pre_ci_boot:
    image_name: ubuntu
    image_tag: latest
    pull: true
    options: "-e HOME=/root"
  ci:
    - sudo rm -f /etc/apt/sources.list.d/opera*
    - sudo rm -f /etc/apt/sources.list.d/cassandra*
    - sudo rm -f /etc/apt/sources.list.d/google-cloud*
    - sudo apt update
    - sudo apt install gcc clang cmake libgtk-3-dev libgcrypt20-dev libzip-dev libjson-glib-dev
    - git clone https://github.com/paolostivanin/libbaseencode.git
    - cd libbaseencode && mkdir build && cd $_
    - cmake .. -DCMAKE_INSTALL_PREFIX=/usr
    - make
    - sudo make install
    - cd ../..
    - git clone https://github.com/paolostivanin/libcotp.git
    - cd libcotp && mkdir build && cd $_
    - cmake .. -DCMAKE_INSTALL_PREFIX=/usr
    - make
    - sudo make install
    - cd ../..    
    - mkdir build && cd $_
    - cmake .. -DCMAKE_INSTALL_PREFIX=/usr
    - make
